---
name: skill-developer
description: Создание и управление скиллами Claude Code по лучшим практикам Anthropic. Используйте при создании новых скиллов, модификации skill-rules.json, понимании триггеров, работе с хуками, отладке активации скиллов или реализации прогрессивного раскрытия. Охватывает структуру скиллов, YAML frontmatter, типы триггеров (ключевые слова, паттерны намерений, пути файлов, паттерны контента), уровни принуждения (block, suggest, warn), механизмы хуков (UserPromptSubmit, PreToolUse), отслеживание сессий и правило 500 строк.
---

# Руководство по разработке скиллов

## Назначение

Полное руководство по созданию и управлению скиллами в Claude Code с системой автоматической активации, следуя официальным лучшим практикам Anthropic, включая правило 500 строк и паттерн прогрессивного раскрытия.

## Когда использовать этот скилл

Автоматически активируется при упоминании:
- Создание или добавление скиллов
- Модификация триггеров или правил скиллов
- Понимание работы активации скиллов
- Отладка проблем активации скиллов
- Работа с skill-rules.json
- Механизмы хуков
- Лучшие практики Claude Code
- Прогрессивное раскрытие
- YAML frontmatter
- Правило 500 строк

---

## Обзор системы

### Архитектура двух хуков

**1. Хук UserPromptSubmit** (Проактивные предложения)
- **Файл**: `.claude/hooks/skill-activation-prompt.ts`
- **Триггер**: ДО того, как Claude увидит промпт пользователя
- **Цель**: Предложить релевантные скиллы на основе ключевых слов + паттернов намерений
- **Метод**: Инжектирует форматированное напоминание как контекст (stdout → ввод Claude)
- **Случаи использования**: Тематические скиллы, неявное обнаружение работы

**2. Stop Hook - Напоминание об обработке ошибок** (Мягкие напоминания)
- **Файл**: `.claude/hooks/error-handling-reminder.ts`
- **Триггер**: ПОСЛЕ того, как Claude закончит отвечать
- **Цель**: Мягкое напоминание о самопроверке обработки ошибок в написанном коде
- **Метод**: Анализирует отредактированные файлы на рискованные паттерны, показывает напоминание при необходимости
- **Случаи использования**: Осведомленность об обработке ошибок без блокирующего трения

**Изменение философии (2025-10-27):** Мы отошли от блокирующего PreToolUse для Sentry/обработки ошибок. Вместо этого используем мягкие пост-ответные напоминания, которые не блокируют рабочий процесс, но поддерживают осведомленность о качестве кода.

### Конфигурационный файл

**Расположение**: `.claude/skills/skill-rules.json`

Определяет:
- Все скиллы и их условия активации
- Уровни принуждения (block, suggest, warn)
- Паттерны путей файлов (glob)
- Паттерны обнаружения контента (regex)
- Условия пропуска (отслеживание сессии, маркеры файлов, переменные окружения)

---

## Типы скиллов

### 1. Защитные скиллы (Guardrail)

**Цель:** Принудительное соблюдение критических практик, предотвращающих ошибки

**Характеристики:**
- Тип: `"guardrail"`
- Принуждение: `"block"`
- Приоритет: `"critical"` или `"high"`
- Блокируют редактирование файлов до использования скилла
- Предотвращают распространённые ошибки (имена колонок, критические ошибки)
- Учитывают сессию (не повторяют напоминание в той же сессии)

**Примеры:**
- `database-verification` - Проверка имён таблиц/колонок перед запросами Prisma
- `frontend-dev-guidelines` - Принуждение паттернов React/TypeScript

**Когда использовать:**
- Ошибки, вызывающие проблемы во время выполнения
- Проблемы целостности данных
- Критические проблемы совместимости

### 2. Доменные скиллы (Domain)

**Цель:** Предоставление комплексного руководства для конкретных областей

**Характеристики:**
- Тип: `"domain"`
- Принуждение: `"suggest"`
- Приоритет: `"high"` или `"medium"`
- Рекомендательные, не обязательные
- Специфичны для темы или домена
- Комплексная документация

**Примеры:**
- `backend-dev-guidelines` - Паттерны Node.js/Express/TypeScript
- `frontend-dev-guidelines` - Лучшие практики React/TypeScript
- `error-tracking` - Руководство по интеграции Sentry

**Когда использовать:**
- Сложные системы, требующие глубоких знаний
- Документация лучших практик
- Архитектурные паттерны
- Практические руководства

---

## Быстрый старт: Создание нового скилла

### Шаг 1: Создание файла скилла

**Расположение:** `.claude/skills/{имя-скилла}/SKILL.md`

**Шаблон:**
```markdown
---
name: my-new-skill
description: Краткое описание, включающее ключевые слова, активирующие этот скилл. Укажите темы, типы файлов и случаи использования. Будьте явными в терминах активации.
---

# Мой новый скилл

## Назначение
Чем помогает этот скилл

## Когда использовать
Конкретные сценарии и условия

## Ключевая информация
Фактическое руководство, документация, паттерны, примеры
```

**Лучшие практики:**
- ✅ **Имя**: Строчные буквы, дефисы, предпочтительна форма герундия (глагол + -ing)
- ✅ **Описание**: Включите ВСЕ ключевые слова/фразы активации (макс. 1024 символа)
- ✅ **Контент**: Менее 500 строк - используйте справочные файлы для деталей
- ✅ **Примеры**: Реальные примеры кода
- ✅ **Структура**: Чёткие заголовки, списки, блоки кода

### Шаг 2: Добавление в skill-rules.json

См. [SKILL_RULES_REFERENCE.md](SKILL_RULES_REFERENCE.md) для полной схемы.

**Базовый шаблон:**
```json
{
  "my-new-skill": {
    "type": "domain",
    "enforcement": "suggest",
    "priority": "medium",
    "promptTriggers": {
      "keywords": ["keyword1", "keyword2"],
      "intentPatterns": ["(create|add).*?something"]
    }
  }
}
```

### Шаг 3: Тестирование триггеров

**Тест UserPromptSubmit:**
```bash
echo '{"session_id":"test","prompt":"ваш тестовый промпт"}' | \
  npx tsx .claude/hooks/skill-activation-prompt.ts
```

**Тест PreToolUse:**
```bash
cat <<'EOF' | npx tsx .claude/hooks/skill-verification-guard.ts
{"session_id":"test","tool_name":"Edit","tool_input":{"file_path":"test.ts"}}
EOF
```

### Шаг 4: Уточнение паттернов

На основе тестирования:
- Добавьте недостающие ключевые слова
- Уточните паттерны намерений для уменьшения ложных срабатываний
- Настройте паттерны путей файлов
- Протестируйте паттерны контента на реальных файлах

### Шаг 5: Следуйте лучшим практикам Anthropic

✅ Держите SKILL.md менее 500 строк
✅ Используйте прогрессивное раскрытие со справочными файлами
✅ Добавляйте оглавление к справочным файлам > 100 строк
✅ Пишите детальное описание с ключевыми словами активации
✅ Тестируйте на 3+ реальных сценариях перед документированием
✅ Итерируйте на основе реального использования

---

## Уровни принуждения

### BLOCK (Критические защиты)

- Физически предотвращает выполнение инструмента Edit/Write
- Код выхода 2 от хука, stderr → Claude
- Claude видит сообщение и должен использовать скилл для продолжения
- **Использовать для**: Критические ошибки, целостность данных, вопросы безопасности

**Пример:** Проверка имён колонок базы данных

### SUGGEST (Рекомендуемые)

- Напоминание инжектируется до того, как Claude увидит промпт
- Claude осведомлён о релевантных скиллах
- Не принудительно, только рекомендательно
- **Использовать для**: Руководство по домену, лучшие практики, практические руководства

**Пример:** Руководство по фронтенд-разработке

### WARN (Опциональные)

- Предложения низкого приоритета
- Только рекомендательно, минимальное принуждение
- **Использовать для**: Желательные предложения, информационные напоминания

**Редко используется** - большинство скиллов либо BLOCK, либо SUGGEST.

---

## Условия пропуска и контроль пользователя

### 1. Отслеживание сессии

**Цель:** Не надоедать повторно в одной сессии

**Как работает:**
- Первое редактирование → Хук блокирует, обновляет состояние сессии
- Второе редактирование (та же сессия) → Хук разрешает
- Другая сессия → Снова блокирует

**Файл состояния:** `.claude/hooks/state/skills-used-{session_id}.json`

### 2. Маркеры файлов

**Цель:** Постоянный пропуск для проверенных файлов

**Маркер:** `// @skip-validation`

**Использование:**
```typescript
// @skip-validation
import { PrismaService } from './prisma';
// Этот файл был проверен вручную
```

**ПРИМЕЧАНИЕ:** Используйте осторожно - при злоупотреблении теряет смысл

### 3. Переменные окружения

**Цель:** Экстренное отключение, временное переопределение

**Глобальное отключение:**
```bash
export SKIP_SKILL_GUARDRAILS=true  # Отключает ВСЕ блокировки PreToolUse
```

**Для конкретного скилла:**
```bash
export SKIP_DB_VERIFICATION=true
export SKIP_ERROR_REMINDER=true
```

---

## Чек-лист тестирования

При создании нового скилла проверьте:

- [ ] Файл скилла создан в `.claude/skills/{name}/SKILL.md`
- [ ] Правильный frontmatter с именем и описанием
- [ ] Запись добавлена в `skill-rules.json`
- [ ] Ключевые слова протестированы с реальными промптами
- [ ] Паттерны намерений протестированы с вариациями
- [ ] Паттерны путей файлов протестированы с реальными файлами
- [ ] Паттерны контента протестированы на содержимом файлов
- [ ] Сообщение блокировки понятно и содержит действия (если защитный)
- [ ] Условия пропуска настроены соответствующим образом
- [ ] Уровень приоритета соответствует важности
- [ ] Нет ложных срабатываний при тестировании
- [ ] Нет пропущенных срабатываний при тестировании
- [ ] Производительность приемлема (<100мс или <200мс)
- [ ] Синтаксис JSON проверен: `jq . skill-rules.json`
- [ ] **SKILL.md менее 500 строк** ⭐
- [ ] Справочные файлы созданы при необходимости
- [ ] Оглавление добавлено к файлам > 100 строк

---

## Справочные файлы

Для детальной информации по конкретным темам см.:

### [TRIGGER_TYPES.md](TRIGGER_TYPES.md)
Полное руководство по всем типам триггеров:
- Триггеры ключевых слов (явное соответствие темы)
- Паттерны намерений (неявное обнаружение действий)
- Триггеры путей файлов (glob паттерны)
- Паттерны контента (regex в файлах)
- Лучшие практики и примеры для каждого
- Типичные ошибки и стратегии тестирования

### [SKILL_RULES_REFERENCE.md](SKILL_RULES_REFERENCE.md)
Полная схема skill-rules.json:
- Полные определения TypeScript интерфейсов
- Пояснения поле за полем
- Полный пример защитного скилла
- Полный пример доменного скилла
- Руководство по валидации и типичные ошибки

### [HOOK_MECHANISMS.md](HOOK_MECHANISMS.md)
Глубокое погружение во внутренности хуков:
- Поток UserPromptSubmit (детально)
- Поток PreToolUse (детально)
- Таблица поведения кодов выхода (КРИТИЧНО)
- Управление состоянием сессии
- Соображения производительности

### [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
Комплексное руководство по отладке:
- Скилл не активируется (UserPromptSubmit)
- PreToolUse не блокирует
- Ложные срабатывания (слишком много активаций)
- Хук вообще не выполняется
- Проблемы производительности

### [PATTERNS_LIBRARY.md](PATTERNS_LIBRARY.md)
Готовая к использованию коллекция паттернов:
- Библиотека паттернов намерений (regex)
- Библиотека паттернов путей файлов (glob)
- Библиотека паттернов контента (regex)
- Организовано по случаям использования
- Готово к копированию

### [ADVANCED.md](ADVANCED.md)
Будущие улучшения и идеи:
- Динамическое обновление правил
- Зависимости скиллов
- Условное принуждение
- Аналитика скиллов
- Версионирование скиллов

---

## Краткий справочник

### Создание нового скилла (5 шагов)

1. Создайте `.claude/skills/{name}/SKILL.md` с frontmatter
2. Добавьте запись в `.claude/skills/skill-rules.json`
3. Тестируйте командами `npx tsx`
4. Уточните паттерны на основе тестирования
5. Держите SKILL.md менее 500 строк

### Типы триггеров

- **Keywords (Ключевые слова)**: Явные упоминания темы
- **Intent (Намерение)**: Неявное обнаружение действий
- **File Paths (Пути файлов)**: Активация на основе расположения
- **Content (Контент)**: Технологически-специфичное обнаружение

См. [TRIGGER_TYPES.md](TRIGGER_TYPES.md) для полных деталей.

### Принуждение

- **BLOCK**: Код выхода 2, только критические
- **SUGGEST**: Инжекция контекста, самый распространённый
- **WARN**: Рекомендательный, редко используется

### Условия пропуска

- **Отслеживание сессии**: Автоматическое (предотвращает повторные напоминания)
- **Маркеры файлов**: `// @skip-validation` (постоянный пропуск)
- **Переменные окружения**: `SKIP_SKILL_GUARDRAILS` (экстренное отключение)

### Лучшие практики Anthropic

✅ **Правило 500 строк**: Держите SKILL.md менее 500 строк
✅ **Прогрессивное раскрытие**: Используйте справочные файлы для деталей
✅ **Оглавление**: Добавляйте к справочным файлам > 100 строк
✅ **Один уровень глубины**: Не вкладывайте ссылки глубоко
✅ **Богатые описания**: Включайте все ключевые слова активации (макс. 1024 символа)
✅ **Сначала тест**: Создайте 3+ тестовых случая перед обширной документацией
✅ **Именование герундием**: Предпочитайте глагол + -ing (напр., "processing-pdfs")

### Отладка

Тестируйте хуки вручную:
```bash
# UserPromptSubmit
echo '{"prompt":"test"}' | npx tsx .claude/hooks/skill-activation-prompt.ts

# PreToolUse
cat <<'EOF' | npx tsx .claude/hooks/skill-verification-guard.ts
{"tool_name":"Edit","tool_input":{"file_path":"test.ts"}}
EOF
```

См. [TROUBLESHOOTING.md](TROUBLESHOOTING.md) для полного руководства по отладке.

---

## Связанные файлы

**Конфигурация:**
- `.claude/skills/skill-rules.json` - Главная конфигурация
- `.claude/hooks/state/` - Отслеживание сессий
- `.claude/settings.json` - Регистрация хуков

**Хуки:**
- `.claude/hooks/skill-activation-prompt.ts` - UserPromptSubmit
- `.claude/hooks/error-handling-reminder.ts` - Stop event (мягкие напоминания)

**Все скиллы:**
- `.claude/skills/*/SKILL.md` - Файлы контента скиллов

---

**Статус скилла**: ЗАВЕРШЁН - Реструктурирован по лучшим практикам Anthropic ✅
**Количество строк**: < 500 (следует правилу 500 строк) ✅
**Прогрессивное раскрытие**: Справочные файлы для детальной информации ✅

**Далее**: Создавайте больше скиллов, уточняйте паттерны на основе использования
