# Типы триггеров - Полное руководство

Полный справочник по настройке триггеров скиллов в системе автоматической активации Claude Code.

## Оглавление

- [Триггеры ключевых слов (Явные)](#триггеры-ключевых-слов-явные)
- [Триггеры паттернов намерений (Неявные)](#триггеры-паттернов-намерений-неявные)
- [Триггеры путей файлов](#триггеры-путей-файлов)
- [Триггеры паттернов контента](#триггеры-паттернов-контента)
- [Сводка лучших практик](#сводка-лучших-практик)

---

## Триггеры ключевых слов (Явные)

### Как работает

Регистронезависимое сопоставление подстроки в промпте пользователя.

### Когда использовать

Активация на основе темы, когда пользователь явно упоминает предмет.

### Конфигурация

```json
"promptTriggers": {
  "keywords": ["layout", "grid", "toolbar", "submission"]
}
```

### Пример

- Промпт пользователя: "как работает система **layout**?"
- Совпадает: ключевое слово "layout"
- Активирует: `project-catalog-developer`

### Лучшие практики

- Используйте конкретные, однозначные термины
- Включайте распространённые вариации ("layout", "layout system", "grid layout")
- Избегайте слишком общих слов ("system", "work", "create")
- Тестируйте с реальными промптами

---

## Триггеры паттернов намерений (Неявные)

### Как работает

Сопоставление regex-паттернов для обнаружения намерения пользователя, даже когда он не упоминает тему явно.

### Когда использовать

Активация на основе действий, когда пользователь описывает, что хочет сделать, а не конкретную тему.

### Конфигурация

```json
"promptTriggers": {
  "intentPatterns": [
    "(create|add|implement).*?(feature|endpoint)",
    "(how does|explain).*?(layout|workflow)"
  ]
}
```

### Примеры

**Работа с базой данных:**
- Промпт пользователя: "добавить функцию отслеживания пользователей"
- Совпадает: `(add).*?(feature)`
- Активирует: `database-verification`, `error-tracking`

**Создание компонента:**
- Промпт пользователя: "создать виджет дашборда"
- Совпадает: `(create).*?(component)` (если component в паттерне)
- Активирует: `frontend-dev-guidelines`

### Лучшие практики

- Захватывайте распространённые глаголы действий: `(create|add|modify|build|implement)`
- Включайте доменно-специфичные существительные: `(feature|endpoint|component|workflow)`
- Используйте нежадное сопоставление: `.*?` вместо `.*`
- Тщательно тестируйте паттерны в тестере regex (https://regex101.com/)
- Не делайте паттерны слишком широкими (вызывает ложные срабатывания)
- Не делайте паттерны слишком специфичными (вызывает пропуски)

### Примеры распространённых паттернов

```regex
# Работа с базой данных
(add|create|implement).*?(user|login|auth|feature)

# Объяснения
(how does|explain|what is|describe).*?

# Работа с фронтендом
(create|add|make|build).*?(component|UI|page|modal|dialog)

# Обработка ошибок
(fix|handle|catch|debug).*?(error|exception|bug)

# Операции с workflow
(create|add|modify).*?(workflow|step|branch|condition)
```

---

## Триггеры путей файлов

### Как работает

Сопоставление glob-паттернов с путём редактируемого файла.

### Когда использовать

Активация для конкретного домена/области на основе расположения файла в проекте.

### Конфигурация

```json
"fileTriggers": {
  "pathPatterns": [
    "frontend/src/**/*.tsx",
    "form/src/**/*.ts"
  ],
  "pathExclusions": [
    "**/*.test.ts",
    "**/*.spec.ts"
  ]
}
```

### Синтаксис glob-паттернов

- `**` = Любое количество директорий (включая ноль)
- `*` = Любые символы в имени директории
- Примеры:
  - `frontend/src/**/*.tsx` = Все .tsx файлы в frontend/src и поддиректориях
  - `**/schema.prisma` = schema.prisma в любом месте проекта
  - `form/src/**/*.ts` = Все .ts файлы в поддиректориях form/src

### Пример

- Редактируемый файл: `frontend/src/components/Dashboard.tsx`
- Совпадает: `frontend/src/**/*.tsx`
- Активирует: `frontend-dev-guidelines`

### Лучшие практики

- Будьте конкретны, чтобы избежать ложных срабатываний
- Используйте исключения для тестовых файлов: `**/*.test.ts`
- Учитывайте структуру поддиректорий
- Тестируйте паттерны с реальными путями файлов
- Используйте более узкие паттерны где возможно: `form/src/services/**` вместо `form/**`

### Распространённые паттерны путей

```glob
# Фронтенд
frontend/src/**/*.tsx        # Все React компоненты
frontend/src/**/*.ts         # Все TypeScript файлы
frontend/src/components/**   # Только директория components

# Бэкенд сервисы
form/src/**/*.ts            # Form сервис
email/src/**/*.ts           # Email сервис
users/src/**/*.ts           # Users сервис

# База данных
**/schema.prisma            # Prisma схема (в любом месте)
**/migrations/**/*.sql      # Файлы миграций
database/src/**/*.ts        # Скрипты базы данных

# Workflow
form/src/workflow/**/*.ts              # Движок workflow
form/src/workflow-definitions/**/*.json # Определения workflow

# Исключения тестов
**/*.test.ts                # TypeScript тесты
**/*.test.tsx               # Тесты React компонентов
**/*.spec.ts                # Spec файлы
```

---

## Триггеры паттернов контента

### Как работает

Сопоставление regex-паттернов с фактическим содержимым файла (что внутри файла).

### Когда использовать

Активация для конкретной технологии на основе того, что код импортирует или использует (Prisma, контроллеры, конкретные библиотеки).

### Конфигурация

```json
"fileTriggers": {
  "contentPatterns": [
    "import.*[Pp]risma",
    "PrismaService",
    "\\.findMany\\(",
    "\\.create\\("
  ]
}
```

### Примеры

**Обнаружение Prisma:**
- Файл содержит: `import { PrismaService } from '@project/database'`
- Совпадает: `import.*[Pp]risma`
- Активирует: `database-verification`

**Обнаружение контроллера:**
- Файл содержит: `export class UserController {`
- Совпадает: `export class.*Controller`
- Активирует: `error-tracking`

### Лучшие практики

- Сопоставляйте импорты: `import.*[Pp]risma` (регистронезависимо с [Pp])
- Экранируйте специальные символы regex: `\\.findMany\\(` а не `.findMany(`
- Паттерны используют флаг регистронезависимости
- Тестируйте на реальном содержимом файлов
- Делайте паттерны достаточно специфичными, чтобы избежать ложных совпадений

### Распространённые паттерны контента

```regex
# Prisma/База данных
import.*[Pp]risma                # Импорты Prisma
PrismaService                    # Использование PrismaService
prisma\.                         # prisma.something
\.findMany\(                     # Методы запросов Prisma
\.create\(
\.update\(
\.delete\(

# Контроллеры/Маршруты
export class.*Controller         # Классы контроллеров
router\.                         # Express router
app\.(get|post|put|delete|patch) # Маршруты Express app

# Обработка ошибок
try\s*\{                        # Блоки try
catch\s*\(                      # Блоки catch
throw new                        # Операторы throw

# React/Компоненты
export.*React\.FC               # React функциональные компоненты
export default function.*       # Экспорты функций по умолчанию
useState|useEffect              # React хуки
```

---

## Сводка лучших практик

### ДЕЛАЙТЕ:
✅ Используйте конкретные, однозначные ключевые слова
✅ Тестируйте все паттерны с реальными примерами
✅ Включайте распространённые вариации
✅ Используйте нежадный regex: `.*?`
✅ Экранируйте специальные символы в паттернах контента
✅ Добавляйте исключения для тестовых файлов
✅ Делайте паттерны путей файлов узкими и специфичными

### НЕ ДЕЛАЙТЕ:
❌ Не используйте слишком общие ключевые слова ("system", "work")
❌ Не делайте паттерны намерений слишком широкими (ложные срабатывания)
❌ Не делайте паттерны слишком специфичными (пропуски)
❌ Не забывайте тестировать в тестере regex (https://regex101.com/)
❌ Не используйте жадный regex: `.*` вместо `.*?`
❌ Не сопоставляйте слишком широко в путях файлов

### Тестирование триггеров

**Тест триггеров ключевых слов/намерений:**
```bash
echo '{"session_id":"test","prompt":"ваш тестовый промпт"}' | \
  npx tsx .claude/hooks/skill-activation-prompt.ts
```

**Тест триггеров путей файлов/контента:**
```bash
cat <<'EOF' | npx tsx .claude/hooks/skill-verification-guard.ts
{
  "session_id": "test",
  "tool_name": "Edit",
  "tool_input": {"file_path": "/path/to/test/file.ts"}
}
EOF
```

---

**Связанные файлы:**
- [SKILL.md](SKILL.md) - Главное руководство по скиллам
- [SKILL_RULES_REFERENCE.md](SKILL_RULES_REFERENCE.md) - Полная схема skill-rules.json
- [PATTERNS_LIBRARY.md](PATTERNS_LIBRARY.md) - Готовая библиотека паттернов
